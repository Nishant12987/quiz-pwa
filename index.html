let freeUsed = localStorage.getItem("freeUsed") === "true";
let isPaid = localStorage.getItem("isPaid") === "true";
let timer, timeLeft = 2400;

function login() {
  const email = emailInput();
  if (!email) return alert("Enter email");
  localStorage.setItem("user", email);
  showDashboard();
}

function showDashboard() {
  hideAll();
  show("dashboard");
  welcome.innerText = "Welcome to PrepOne";
  accessMsg.innerText = isPaid
    ? "Full access unlocked"
    : freeUsed
      ? "Free test used. Unlock full tests."
      : "You have 1 free test available";
}

function startTest() {
  if (!isPaid && freeUsed) {
    alert("Please unlock full tests");
    showUnlock();
    return;
  }
  hideAll();
  show("quiz");
  timeLeft = 2400;
  startTimer();
  loadQuestion();
}

function loadQuestion() {
  qCounter.innerText = "Sample Question";
  question.innerText = "PrepOne sample REET question";
  options.innerHTML = "";
  ["A","B","C","D"].forEach(o => {
    let b = document.createElement("button");
    b.innerText = o;
    b.onclick = finish;
    options.appendChild(b);
  });
}

function finish() {
  clearInterval(timer);
  hideAll();
  show("result");

  if (!isPaid) localStorage.setItem("freeUsed","true");

  resultTitle.innerText = "Test Completed";
  scoreText.innerText = "Score calculated";
  motivation.innerText = isHindi()
    ? "अच्छा प्रयास! अभ्यास जारी रखें।"
    : "Good effort! Keep practicing.";
}

function showUnlock() {
  hideAll();
  show("unlock");
}

function confirmPayment() {
  localStorage.setItem("isPaid","true");
  isPaid = true;
  alert("Access unlocked on this device");
  showDashboard();
}

function startTimer() {
  timer = setInterval(() => {
    timeLeft--;
    time.innerText = Math.floor(timeLeft/60)+":"+String(timeLeft%60).padStart(2,"0");
    if (timeLeft <= 0) finish();
  },1000);
}

function hideAll() {
  ["login","dashboard","quiz","result","unlock"].forEach(id=>{
    let e=document.getElementById(id);
    if(e) e.style.display="none";
  });
}
function show(id){document.getElementById(id).style.display="block";}
function emailInput(){return document.getElementById("email").value;}
function isHindi(){return false;}
